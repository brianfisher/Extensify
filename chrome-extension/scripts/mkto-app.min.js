console.log("Marketo App > Running");var currentUrl=window.location.href,mktoAppDomain="^https:\/\/app-[a-z0-9]+\.marketo\.com",mktoDesignerDomain="^https:\/\/[a-z0-9]+-[a-z0-9]+\.marketodesigner\.com",mktoWizard=mktoAppDomain+"/m#",APP=APP||{};APP.getCookie=function(cookieField){console.log("Marketo App > Getting: Cookie "+cookieField);var name=cookieField+"=",cookies=document.cookie.split(';'),currentCookie;for(var ii=0;ii<cookies.length;ii++){var currentCookie=cookies[ii].trim();if(currentCookie.indexOf(name)==0){return currentCookie.substring(name.length,currentCookie.length);}}
return null;}
APP.enableProgramAnalyzerDataExport=function(){if(Mkt&&Mkt.widgets&&Mkt.widgets.ToolbarButton&&Mkt.widgets.ToolbarButton.prototype&&Mkt.widgets.ToolbarButton.prototype.showMenu){console.log("Marketo App > Enabling: Program Analyzer Data Export");Mkt.widgets.ToolbarButton.prototype.showMenu=function(){var activeTabTitle=MktCanvas.getActiveTab().title,itemId="newReport_atxCanvasOverview",exportItem,exportHandler,currDatetime,currDatetimeAppend,filename,file,fileUrl;if(activeTabTitle=="Program Analyzer"&&!this.menu.items.get(itemId)){console.log("Marketo App > Executing: Program Analyzer Data Export");currDatetime=new Date(),currDatetimeAppend=currDatetime.getFullYear()+'-'+(currDatetime.getMonth()+1)+'-'+currDatetime.getDate()+'T'+currDatetime.getHours()+':'+currDatetime.getMinutes()+':'+currDatetime.getSeconds(),filename="programAnalyzerExport_"+currDatetimeAppend+".json",file=new Blob([JSON.stringify(JSON.parse(MktPage.appVars.analyzerData.GET_PROGRAM_DATA),null,2)],{type:"application/json"}),fileUrl=URL.createObjectURL(file),exportItem=this.menu.items.get("deleteReport").cloneConfig(),exportHandler=function(){window.open(fileUrl,filename)},exportItem.itemId=itemId,exportItem.setText("Export Data"),exportItem.setIconClass("mkiExcel"),exportItem.setHandler(exportHandler),this.menu.items.add(itemId,exportItem);}
this.showingMenu=true;if(this.menu.xtra){delete this.menu.xtra;}
this.menu.triggeredFrom='button';this.fireEvent('beforemenushow',this.menu);Mkt.widgets.ToolbarButton.superclass.showMenu.call(this);if(fileUrl&&filename&&activeTabTitle=="Program Analyzer"){exportItem=this.menu.items.get(itemId);if(exportItem&&exportItem.el&&exportItem.el.dom&&exportItem.el.dom.href&&exportItem.el.dom.download==""){exportItem.el.dom.href=fileUrl,exportItem.el.dom.download=filename;}}
this.showingMenu=false;}}}
if(currentUrl.search(mktoAppDomain)!=-1&&currentUrl.search(mktoDesignerDomain)==-1&&currentUrl.search(mktoWizard)==-1){console.log("Marketo App > Location: Marketo URL");var isMktPage=window.setInterval(function(){if(typeof(MktPage)!=="undefined"){console.log("Marketo App > Location: Marketo Page");window.clearInterval(isMktPage);if(APP.getCookie("toggleState")!="false"){APP.enableProgramAnalyzerDataExport();}}},0);}